<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üçø Popcorn Hub Beta ‚Äî Full</title>

<!-- Cloudflare Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --bg:#060606;
  --card:#141414;
  --accent:#ffffff; /* white accent */
  --muted:#9a9a9a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:linear-gradient(180deg,#040404,#0e0e0e);
  color:#fff; font-family:Inter, "Segoe UI", Arial, sans-serif;
  -webkit-font-smoothing:antialiased;
}
.header{
  position:sticky; top:0; z-index:60; display:flex; align-items:center; gap:16px; padding:12px 18px;
  backdrop-filter: blur(6px); background: rgba(5,5,5,0.75);
}
.logo{ font-weight:800; color:var(--accent); display:flex; align-items:center; gap:8px; font-size:18px }
.search{ flex:1; display:flex; background:#111; padding:6px; border-radius:8px; gap:8px; align-items:center }
.search input{ flex:1; background:transparent; border:0; outline:0; color:#fff; padding:8px; font-size:14px; }

/* white buttons (accent) with black text for contrast */
.btn{ background:var(--accent); border:0; color:#000; padding:8px 12px; border-radius:8px; cursor:pointer; display:inline-flex; gap:8px; align-items:center; }
.btn.secondary{ background:#333; color:#fff; }

.container{ max-width:1200px; margin:0 auto; padding:20px 16px 40px 16px; }
.section{ margin-bottom:26px; }
.h2{ display:flex; align-items:center; gap:8px; margin-bottom:12px; font-size:18px; }
.grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px; }
.card{ background:var(--card); border-radius:10px; overflow:hidden; cursor:pointer; position:relative; transition:transform .18s; }
.card:hover{ transform:translateY(-6px) }
.card img{ width:100%; height:220px; object-fit:cover; display:block }
.card .title{ padding:8px; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.overlay{ position:absolute; inset:0; display:flex; justify-content:center; align-items:center; opacity:0; background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.55)); transition:.14s }
.card:hover .overlay{ opacity:1 }
.play-fab{ width:56px; height:56px; border-radius:50%; background:var(--accent); color:#000; display:grid; place-items:center; font-size:18px; box-shadow:0 8px 20px rgba(0,0,0,0.6) }

/* remove/trash button on cards */
.remove-btn{
  position:absolute;
  top:8px;
  right:8px;
  background:rgba(0,0,0,0.6);
  border:0;
  color:#fff;
  width:32px;
  height:32px;
  border-radius:50%;
  cursor:pointer;
  display:grid;
  place-items:center;
  z-index:20;
}
.remove-btn:hover{ background:#fff; color:#000; }

/* DETAILS PAGE */
#details{ display:none; padding-bottom:40px }
.details-hero{ display:flex; gap:20px; align-items:flex-start }
.details-hero img{ width:320px; border-radius:12px; object-fit:cover }
.details-right{ flex:1 }
.small{ color:var(--muted); font-size:13px }

/* PLAYER - FULLSCREEN IFRAME */
#player{ display:none; position:fixed; inset:0; z-index:999; background:#000; }

/* top controls sit above iframe */
.player-top{
  position:fixed;
  top:12px;
  left:12px;
  right:12px;
  z-index:1001;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px;
  pointer-events:auto;
}
.player-top .left, .player-top .right { display:flex; gap:8px; align-items:center; }

/* full-bleed iframe behind controls */
#player iframe{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  border:0;
  z-index:1000;
}

/* hide empty sections */
.hidden { display:none !important; }

@media (max-width:900px){
  .card img{ height:180px }
  .details-hero{ flex-direction:column }
  .details-hero img{ width:100% }
}
</style>
</head>
<body>

<div class="header">
  <div class="logo">üçø Popcorn Hub <small style="font-size:12px;color:#ddd">Beta</small></div>
  <div class="search" role="search">
    <input id="searchInput" placeholder="Search movies or TV shows ‚Äî try 'inception'">
    <button id="searchBtn" class="btn" title="Search"><i class="fa-solid fa-magnifying-glass"></i></button>
  </div>
  <button id="homeBtn" class="btn" title="Home"><i class="fa-solid fa-house-chimney"></i></button>
</div>

<!-- HOME -->
<main id="home" class="container" aria-live="polite">

  <section id="continueSection" class="section">
    <div class="h2"><i class="fa-solid fa-clock-rotate-left"></i> Continue Watching</div>
    <div id="continueGrid" class="grid"></div>
  </section>

  <section id="watchlistSection" class="section">
    <div class="h2"><i class="fa-solid fa-heart"></i> Watchlist</div>
    <div id="watchlistGrid" class="grid"></div>
  </section>

  <section class="section">
    <div class="h2" id="mainTitle"><i class="fa-solid fa-fire"></i> Trending</div>
    <div id="mainGrid" class="grid"></div>
  </section>

</main>

<!-- DETAILS PAGE (full screen) -->
<main id="details" class="container" aria-hidden="true">
  <button id="detailsBack" class="btn secondary"><i class="fa-solid fa-arrow-left"></i> Back</button>

  <div class="details-hero" style="margin-top:16px">
    <img id="dPoster" src="" alt="Poster">
    <div class="details-right">
      <h1 id="dTitle"></h1>
      <div id="dMeta" class="small" style="margin-bottom:8px"></div>
      <p id="dOverview" class="small"></p>

      <div style="margin-top:16px; display:flex; gap:8px; align-items:center">
        <button id="playBtn" class="btn"><i class="fa-solid fa-play"></i> Play</button>
        <button id="trailerBtn" class="btn secondary"><i class="fa-brands fa-youtube"></i> Trailer</button>
        <button id="addBtn" class="btn secondary"><i class="fa-solid fa-plus"></i> Add to Watchlist</button>
      </div>
    </div>
  </div>
</main>

<!-- PLAYER (full-screen iframe) -->
<div id="player" aria-hidden="true">
  <div class="player-top" role="toolbar" aria-label="Player controls">
    <div class="left">
      <button id="playerBack" class="btn secondary"><i class="fa-solid fa-arrow-left"></i> Back</button>
    </div>
    <div class="right">
      <button id="prevEp" class="btn secondary" title="Previous Episode"><i class="fa-solid fa-backward-step"></i></button>
      <button id="nextEp" class="btn" title="Next Episode"><i class="fa-solid fa-forward-step"></i> </button>
      <button id="playerClose" class="btn secondary"><i class="fa-solid fa-xmark"></i> Close</button>
    </div>
  </div>

  <iframe id="playerFrame" title="player" sandbox="allow-scripts allow-same-origin allow-popups"></iframe>
</div>

<script>
/**************************************
 üçø Popcorn Hub Beta ‚Äî FULL JS SCRIPT
 Author: Andy üòé
**************************************/

/* ================= CONFIG ================= */

const API_KEY = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxMDBiMDIzOWQzNGY5YzI0Yjc2MzM5Mjg2YjNlOWNiMSIsIm5iZiI6MTc0ODUwMzgzMS43NjMsInN1YiI6IjY4MzgwZDE3MDc5YTQyZTI4NzAzODYyMyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.ykvYVrw8wjBdjkeb-71y1n1Z8ng3xE5ciodJ6FZgrNw';
const HEADERS = { Authorization: `Bearer ${API_KEY}` };
const IMG = p => p ? `https://image.tmdb.org/t/p/w500${p}` : '';

/* ================= DOM ================= */

const home = document.getElementById('home');
const details = document.getElementById('details');
const player = document.getElementById('player');
const frame = document.getElementById('playerFrame');

const mainGrid = document.getElementById('mainGrid');
const continueGrid = document.getElementById('continueGrid');
const watchlistGrid = document.getElementById('watchlistGrid');

const continueSection = continueGrid.parentElement;
const watchlistSection = watchlistGrid.parentElement;

const dPoster = document.getElementById('dPoster');
const dTitle = document.getElementById('dTitle');
const dOverview = document.getElementById('dOverview');

const playBtn = document.getElementById('playBtn');
const trailerBtn = document.getElementById('trailerBtn');
const addBtn = document.getElementById('addBtn');

const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');

const nextBtn = document.getElementById('nextEp');

/* ================= STATE ================= */

let currentItem = null;
let season = 1;
let episode = 1;
let tvCache = {};
let seasonCache = {};

/* ================= COOKIES ================= */

function setCookie(name, val, days = 90) {
  document.cookie = `${name}=${encodeURIComponent(JSON.stringify(val))};path=/;max-age=${days*86400}`;
}
function getCookie(name) {
  const m = document.cookie.match(new RegExp('(^| )'+name+'=([^;]+)'));
  return m ? JSON.parse(decodeURIComponent(m[2])) : [];
}

/* ================= FETCH ================= */

async function fetchJSON(url){
  const r = await fetch(url,{headers:HEADERS});
  return await r.json();
}

/* ================= CARDS ================= */

function createCard(item, removable=false, removeFn=null){
  const c = document.createElement('div');
  c.className = 'card';
  c.innerHTML = `
    <img src="${IMG(item.poster_path)}">
    ${removable ? `<button class="remove-btn"><i class="fa fa-trash"></i></button>` : ''}
    <div class="hover"><div class="play"><i class="fa fa-play"></i></div></div>
    <div class="title">${item.title || item.name}</div>
  `;
  c.onclick = ()=>openDetails(item);
  if(removable){
    c.querySelector('.remove-btn').onclick = e=>{
      e.stopPropagation();
      removeFn(item.id);
    };
  }
  return c;
}

/* ================= HOME ================= */

async function loadTrending(){
  const d = await fetchJSON('https://api.themoviedb.org/3/trending/all/week');
  mainGrid.innerHTML='';
  d.results.forEach(i=>mainGrid.append(createCard(i)));
}

function loadContinue(){
  const list = getCookie('continue');
  continueGrid.innerHTML='';
  if(!list.length){continueSection.style.display='none';return;}
  continueSection.style.display='block';
  list.forEach(i=>continueGrid.append(createCard(i,true,removeContinue)));
}

function loadWatchlist(){
  const list = getCookie('watchlist');
  watchlistGrid.innerHTML='';
  if(!list.length){watchlistSection.style.display='none';return;}
  watchlistSection.style.display='block';
  list.forEach(i=>watchlistGrid.append(createCard(i,true,removeWatchlist)));
}

/* ================= SEARCH ================= */

async function search(){
  const q = searchInput.value.trim();
  if(!q){loadTrending();return;}
  const d = await fetchJSON(`https://api.themoviedb.org/3/search/multi?query=${encodeURIComponent(q)}`);
  mainGrid.innerHTML='';
  d.results.filter(i=>i.poster_path).forEach(i=>mainGrid.append(createCard(i)));
}

/* ================= DETAILS ================= */

function openDetails(item){
  currentItem = item;
  season = 1;
  episode = 1;
  home.style.display='none';
  details.style.display='block';
  dPoster.src = IMG(item.poster_path);
  dTitle.textContent = item.title || item.name;
  dOverview.textContent = item.overview || '';
}

function goHome(){
  details.style.display='none';
  home.style.display='block';
}

/* ================= WATCHLIST ================= */

function toggleWatchlist(){
  let list = getCookie('watchlist');
  if(list.find(i=>i.id===currentItem.id)) return;
  list.push(currentItem);
  setCookie('watchlist',list);
  loadWatchlist();
}
function removeWatchlist(id){
  setCookie('watchlist', getCookie('watchlist').filter(i=>i.id!==id));
  loadWatchlist();
}

/* ================= CONTINUE ================= */

function saveContinue(){
  let list = getCookie('continue').filter(i=>i.id!==currentItem.id);
  list.unshift({...currentItem, season, episode});
  setCookie('continue', list.slice(0,10));
  loadContinue();
}
function removeContinue(id){
  setCookie('continue', getCookie('continue').filter(i=>i.id!==id));
  loadContinue();
}

/* ================= PLAYER ================= */

async function play(){
  if(currentItem.media_type==='tv'){
    frame.src = `https://fmovies4u.com/embed/tmdb-tv-${currentItem.id}-season/${season}-eps/${episode}`;
  }else{
    frame.src = `https://fmovies4u.com/embed/tmdb-movie-${currentItem.id}`;
  }
  player.style.display='block';
  saveContinue();
}

function closePlayer(){
  frame.src='';
  player.style.display='none';
}

/* ================= NEXT EPISODE ================= */

async function nextEpisode(){
  if(currentItem.media_type!=='tv') return;

  const tv = tvCache[currentItem.id] ||= await fetchJSON(`https://api.themoviedb.org/3/tv/${currentItem.id}`);
  const s = tv.seasons.find(x=>x.season_number===season);
  const epCount = s?.episode_count || 0;

  if(episode < epCount){
    episode++;
  }else{
    const next = tv.seasons.find(x=>x.season_number>season && x.episode_count>0);
    if(!next){alert('End of series');return;}
    season = next.season_number;
    episode = 1;
  }
  play();
}

/* ================= EVENTS ================= */

playBtn.onclick = play;
addBtn.onclick = toggleWatchlist;
searchBtn.onclick = search;
nextBtn.onclick = nextEpisode;

/* ================= INIT ================= */

loadTrending();
loadContinue();
loadWatchlist();
</script>
</body>
</html>